# 概率论

参考: https://zhuanlan.zhihu.com/p/42859784

## 一、基本概念

### 1.1 基本概念

定义:

> 随机试验中出现的可能结果称为样本点,记作$\omega$
>
> 所有样本点组成的集合称为样本空间,记作$\Omega=\left \{ \omega|\omega为样本点\right \}$
>
> 当样本空间$\Omega$仅有有限个元素时,称其子集为一个事件,用大写字母表示,如$A$。

若样本点$\omega\in A$,称事件$A$发生,否则称事件不发生。$\overline{A}=\Omega-A$称为事件$A$的对立事件。容易知道$\omega\in A\Leftrightarrow \omega\not\in \overline{A}$,反之亦然。

特别地,$A=\varnothing$时,事件称为不可能事件。$A=\Omega$时,事件称为必然事件。


设$A,B$为事件,之后用$AB$来表示$A\cap B$。特别地,当$AB=\varnothing$时,称这两个事件互斥(不相容)。对多于两个事件,称这些事件互斥当且仅当这些事件中的任意两个都互斥。记$A\cup B$为$A+B$。


给出几个很常用的事件之间的运算公式,读者容易自证:

> $A\cup B=A+\overline{A}B, \ A=AB+A\overline{B}$
>
> $\overline{ \bigcup_{j=1}^n A_j }=\bigcap _{j=1}^n \overline{A_j}$,$\overline{ \bigcap_{j=1}^n A_j }=\bigcup _{j=1}^n \overline{A_j}$.(De-Morgan)


### 1.2 古典概型

对一个有限集合$A$,$|A|$表示其中的元素个数。

定义:试验的样本空间$\Omega$有限,$A\subseteq \Omega$,若$\Omega$中的每个样本点的发生的可能性相同,则称$P(A)=\frac{|A|}{|\Omega|}$为事件$A$发生的概率。由以上定义的概率模型便称为古典概型。

需要再一次强调的是:每个样本点的发生的可能性相同,这是前提条件,如果忽视条件直接套用古典概型就会犯错。

关于如此定义出的概率$P$的性质,列出以下几条,读者自证。

> * $P(A)\geq 0$
> * $P(\Omega)=1,P(\varnothing)=0$
> * 若$A_1,A_2,...,A_n$互斥,则$P(\sum_{j=1}^nA_j)=\sum_{j=1}^nP(A_j)$。(有限可加性)


例:计算以下方法数:(假设不同排列均等可能)有$n$个不同的球,每次抽取抽取1个球

> 有放回地抽取,抽取$m$个排成一列,求不同排列总数。 乘法原理$n^m$
>
> 无放回地抽取,抽取$m$个排成一列,求不同排列总数。排列数$P_n^m=\frac{n!}{(n-m)!}$
>
> 无放回地抽取，抽取$m$个忽视次序地组成一组,求不同组合总数。组合数$C_n^m=\frac{n!}{m!(n-m)!}$
>
> 将所有球分成$k$个不同的组,忽视每一组中元素的次序,且每组恰好有$n_1,n_2,...,n_k$个球($n_1+n_2+...+n_k=n$),求不同分组结果数。$C_n^{n_1}C_{n-n_1}^{n_2}...C_{n-n_1-...-n_{k-1}}^{n_k}=\frac{n!}{n_1!n_2!...n_k!}$,将这个数记作$\binom{n}{n_1,n_2,...,n_k}$,其为多项式$(x_1+x_2+...+x_k)^n$中$x_1^{n_1}x_2^{n_2}...x_k^{n_k}$的展开系数,称为多项式系数。

> 方程$x_1+x_2+...+x_n=m$的非负整数解的个数。隔板法($C_{m+n-1}^{n-1}$)
>
> 方程$x_1+x_2+...+x_n=m$的正整数解的个数。插空法($C_{m-1}^{n-1}$)


### 1.3 几何概型

对于$A\subseteq \mathbb{R}^r$,设$A$的体积存在,记为$m(A)$,后文可能也会称其为测度(不严格意义上)。

定义:试验的样本空间$\Omega$,$m(\Omega)>0$,$A\subseteq \Omega$,若每个样本点等可能地落在$\Omega$中,则称$P(A)=\frac{m(A)}{m(\Omega)}$为事件$A$发生的概率。由以上定义的概率模型便称为几何概型。

类似于古典概型，需要再一次强调的是：每个样本点等可能地落在$\Omega$中

**等待-相遇问题**:两人某天1点到2点之间等可能地在随机时间到达某地点会面且两人的到达时间相互不影响,先到者等20min后离去,求两人能相遇的概率。

解:设$x,y$为两人分别到达的时间,样本空间$\Omega=\left \{ (x,y)|0\leq x,y\leq 60 \right \}$,符合几何概型要求。

事件$A$:两人能够相遇$A\subseteq \Omega$,则$A=\left \{ (x,y)||x-y|\leq 20\right \}$

画图得:

<img src="http://pic2.zhimg.com/v2-abae587e4b867d45db91a54c7dc15745_b.jpg" style="width: 30%">

$m(A)$即为围成的六边形面积$=60^2-40^2$,$m(\Omega)=60^2$,故$P(A)=\frac{5}{9}$。

注意:概型的差别的根源是等可能假设之间的差别,为了进一步体会这一点,举有趣的Bertrand问题作为例子来说明这一点。

**例(Bertrand):在半径为1的圆内任意取一条弦,求弦长度大于等于$\sqrt{3}$的概率。**

解:这个问题乍看之下让人手足无措，其原因就在于题中完全没有说明弦要按照怎么样的方式来选取。我们可以通过确定弦的两个端点来确定弦,也可以通过确定弦的中点来确定弦。更深入地,在讨论关于弦的中点的问题时,我们既可以假设中点在圆中等可能分布,也可以假设弦在圆的直径上等可能分布。

下面我们举出三种常见的等可能假设并分别求概率。

设事件$A$:弦长度大于等于$\sqrt{3}$

**情况1**:弦的端点等可能地落在圆周上。

则我们可以假设一个端点固定,则另一个端点也等可能地落在圆周上。如图:

<img src="http://pic4.zhimg.com/v2-fb6bd097599a43ef7e21327994e15c97_b.jpg" style="width: 30%" >

固定点$C$,假设$|CB|=|CD|=\sqrt{3}$,则另一个端点只需要在$B,D$所夹劣弧之上都满足要求。则样本空间$\Omega=\left \{ \theta|\theta\in [0,2\pi ) \right \}$,$A=\left \{ \theta|\theta\in [\frac{2}{3}\pi ,\frac{4}{3}\pi ] \right \}$。容易求出$P(A)=\frac{1}{3}$。

**情况2**:弦的中点等可能地落在一个小圆内。

如图:

<img src="https://pic1.zhimg.com/80/v2-8867261d39ec200e76f040bb033d2cb0_1440w.jpg" style="width: 30%" >

$|BC|=|EF|=\sqrt{3}$,则这两条弦的中点在同一个小圆上,容易知道当弦的中点在小圆上或内时,弦长必定符合条件要求。利用几何概型,$m(\Omega)=\pi ,m(A)=\frac{\pi}{4}$,$P(A)=\frac{1}{4}$。

**情况3**:弦中点等可能地落在与之垂直的直径上。

如图:

<img src="https://pic2.zhimg.com/v2-85f57e04fdf7cd429b7b92bf5ad5deb1_b.jpg" style="width: 30%">

$|BC|=\sqrt{3}$,容易知道当弦中点在小圆之内时,满足条件要求。由于沿着直径等可能分布。故$P(A)=\frac{1}{2}$。

可以看到不同的等可能假设导致了最后截然不同的结果。然而,这些结果之间并无对错之分,只是从不同角度看同一个问题得到了不同的结果。


### 1.4 概率空间

$A,B$为测度存在的事件,则$\overline{A},A\cup B,A\cap B,A-B$也都可测。故可测事件事件经过有限次集合运算后得到的事件也必定可测。

现在若有事件列$A_1,A_2,...$互斥且均可测,则由体积的性质,$m(\bigcup _{j=1}^{\infty}A_j)=\sum_{j=1}^{\infty}m(A_j)$,故互斥的可测事件经过可列并后仍旧可测。

现在考虑,更广泛地,事件列$B_1,B_2,...$,均可测(不一定互斥)。进行变换$A_1=B_1,A_2=B_2-B_1,...,A_j=B_j-B_{j-1}-...-B_1$,则事件列$A_1,A_2,...$互斥且均可测,且有$\bigcup_{j=1}^{\infty}A_j=\bigcup_{j=1}^{\infty}B_j$,利用上述结论,可以得到$\bigcup_{j=1}^{\infty}B_j$可测。故可测事件经过可列并后仍旧可测。

自然地,我们引出如下定义:$\Omega$为样本空间,$F$为$\Omega$的子集构成的集合,若$F$满足:

> 1. $\Omega\in F$
> 2. 若$A\in F,\overline{A}\in F$(对补集运算封闭)
> 3. 若$A_j\in F,\bigcup_{j=1}^{\infty}A_j\in F$(对可列并运算封闭)

则$F$为$\Omega$的事件域/$\sigma$域,称$(\Omega,F)$为可测空间。

在可测空间上,我们得以严格定义概率,作为一种测度而存在。

定义:$(\Omega,F)$为可测空间,$P$为定义在$F$上的函数,若满足:

> 1. $\forall A\in F,P(A)\geq 0$(非负性)
> 2. $P(\Omega)=1$(完全性)
> 3. 对$A_1,A_2,...$为$F$中的互斥事件列,有$P(\bigcup _{j=1}^{\infty}A_j)=\sum_{j=1}^{\infty}P(A_j)$(可列可加性)

则$P$为$F$上的概率测度,简称概率,$(\Omega,F,P)$称为概率空间。

定义:$A$为事件,若$P(A)=1$,称$A$几乎必然发生,记作$A \ a.s.$。(almost surely)

### 1.5 概率的性质

关于概率的加法性质,给出以下性质:

> 1. $P(A\cup B)=P(A)+P(B)-P(AB)$
> 2. 若$B\subseteq A,P(A-B)=P(A)-P(B),P(A)\geq P(B)$
> 3. (Jordan公式)$P(\bigcup _{j=1}^nA_j)=\sum_{k=1}^n(-1)^{k-1}\sum_{1\leq j_1<j_2<...<j_k\leq n}P(A_{j_1}A_{j_2}...A_{j_k})$

事实上,在对数学期望的性质有了解后,我们可以利用数学期望与概率之间的联系给出容易的证明。关于概率的连续性,可能是我们较为陌生的方面,但是十分重要。

**定义:** 若$A_1\subseteq A_2\subseteq...$,称此事件列单调递增。类似地,可以定义单调递减的事件列。

定理:(概率的连续性)

> 若$A_1,A_2,...$为单调递增事件列,$P(\bigcup_{j=1}^{\infty}A_j)=\lim_{n\rightarrow \infty}P(A_n)$.
> 
> 若$B_1,B_2,...$为单调递减事件列,$P(\bigcap_{j=1}^{\infty}B_j)=\lim_{n\rightarrow \infty}P(B_n)$。

想法是利用上文提到的变换将事件列变为互斥事件列寻求简化。$C_1=A_1,C_2=A_2-A_1,...,C_j=A_j-A_{j-1}-...-A_1$,则$C_1,C_2,...$为互斥事件列,且$\bigcup_{j=1}^{\infty}A_j=\bigcup_{j=1}^{\infty}C_j$,故$P(\bigcup_{j=1}^{\infty}A_j)=P(\bigcup_{j=1}^{\infty}C_j)=\sum_{j=1}^{\infty}P(C_j)=\lim _{n\rightarrow \infty}\sum_{j=1}^n[P(A_j)-P(A_{j-1})]=\lim_{n\rightarrow \infty}P(A_n)$。

之所以称为连续性是因为定理表达了如下含义：递增事件列的概率的极限等于事件列的极限(可列并)的概率,也就是说概率测度与极限是可交换的。

形象地理解,如果一个递减事件列,其中事件发生概率越来越小,那么所有事件同时发生的概率等于最小的那个事件发生的概率。如果一个递增事件列,其中事件发生概率越来越大,那么所有事件中至少有一个事件发生的概率等于最大的那个事件发生的概率。事实上,概率的连续性定理仅仅是将这样的想法严格化了而已。

### 1.6 条件概率、乘法公式

考虑如下问题:掷一次骰子,已知投掷出的点数为偶数,求投出2的概率。

我们注意到在附加了“投掷出的点数为偶数”的条件后,利用古典概型时,事件“投出2”并未改变。变化的是样本空间,它被缩小了。所以条件概率的本质其实是对样本空间的限制。

**定义:** $A,B$为事件,则$P(B|A)$指的是在条件$A$下$B$发生的条件概率。

自然地,我们想建立条件概率与一般概率之间的联系。我们不妨设$P(A)>0$,否则条件概率必为0。

我们先考虑简单的情况:古典概型下的情况。此时$P(B|A)=P(AB|A)=\frac{|AB|}{|A|}=\frac{\frac{|AB|}{|\Omega|}}{\frac{|A|}{|\Omega|}}=\frac{P(AB)}{P(A)}$,由此,我们得到了重要的乘法公式。

**乘法公式:** $P(A)>0,P(B|A)=\frac{P(AB)}{P(A)}$


模仿概率测度的定义,我们可以定义条件概率测度。**$(\Omega,F)$为可测空间,$A,B\in F$,$P(A)>0$,$P(A)$为定义在$F$上的函数,$P_A(B)=P(B|A)$,$P_A$满足概率测度的定义。**所以事实上,对概率测度成立的性质对条件概率测度同样成立。

我们给出几条常用的性质:

> 1. 若$P(AB)>0$,$P_A(C|B)=P(C|AB)$
> 
> 2. 若$P(A_1A_2...A_{n-1})>0$,有$P(A_1A_2...A_n)=P(A_1)P(A_2|A_1)...P(A_n|A_1A_2...A_{n-1})$。

### 1.7 事件的独立性

独立性,顾名思义,指的是两个事件相互不产生影响。换句话说,可以理解为有无$A$事件发生作为条件都不影响$B$事件发生的概率。即$P(B|A)=P(A)$,同乘$P(A)$得到$P(AB)=P(A)P(B)$。所以很自然地引出如下定义:

**定义:** 若事件$A,B$满足$P(AB)=P(A)P(B)$,则$A$与$B$独立。

在这里需要注意的是事件多于两个的情况。

**定义:** 若事件$A_1,A_2,...,A_n$满足$P(A_1A_2...A_n)=P(A_1)P(A_2)...P(A_n)$,则称这些事件相互独立。

我们有必要区分两两独立和相互独立的概念。事实上,相互独立则必定两两独立,但是反之不成立。

**反例:** 考虑一个四面体,一面红色,一面黄色,一面蓝色,一面三种颜色都有。现在掷此四面体。

$A$:朝下面包含红色,$B$:朝下面包含黄色,$C$:朝下面包含蓝色。则容易得到$P(A)=P(B)=P(C)=\frac{1}{2}$,$P(AB)=P(AC)=P(BC)=\frac{1}{4}$,$P(ABC)=\frac{1}{4}$。

故$P(AB)=P(A)P(B)$,同理另外两个式子成立,故这三个事件两两独立。但是$P(ABC)\neq P(A)P(B)P(C)$,不相互独立。

### 1.8 全概公式,Bayes公式

**定理(全概率公式):** 事件$A_1,A_2,...,A_n$互斥,$B\subseteq \bigcup _{j=1}^nA_j$,则$P(B)=\sum_{j=1}^nP(A_j)P(B|A_j)$。

证明:利用概率的有限可加性,逆用条件概率乘法公式。

$$P(B)=P(\bigcup _{j=1}^nBA_j)=\sum_{j=1}^nP(BA_j)=\sum_{j=1}^nP(A_j)P(B|A_j)$$

全概率公式也可以理解为$A_1,A_2,...,A_n$提供了事件$B$的一个两两不交的划分,所以$B$发生的概率就被拆成了$n$个小块的概率之和。全概公式看上去简单,实际非常常用。比如:抽签的公平性就可以用全概公式加以证明。

例:(抽签公平性) $n$个球,$m$个黑,剩下全为白,球除了颜色外没有任何差别。求证:无放回地依次抽取球,每一次抽中黑球的概率都是$\frac{m}{n}$。

证明:利用数学归纳法,这里着重证明数学归纳法的第二步。事件$A_j$表示第$j$次抽到了黑球。

由归纳假设,对一切$m\leq n$,$P(A_{j-1})=\frac{m}{n}$。已知$P(A_{1})=\frac{m}{n}$,
由全概公式, $P(A_j)=P(A_1)P(A_j|A_1)+P(\overline{A_1})P(A_j|\overline{A_1})=\frac{m}{n}\frac{m-1}{n-1}+\frac{n-m}{n}\frac{m}{n-1}=\frac{m}{n}$,故得证。

我们接着再来介绍全概公式一个有趣的应用:为何赌博者无限赌下去总是倾向于破产?在这个例子中,我们同时介绍一种在概率论中常用的方法:递推公式法。

**例:(赌徒破产)** 一个人有$a$的本金,打算再赢$b$元就停止赌博,设每局$p=\frac{1}{2}$概率赢,输赢对金钱影响都是$1$,输光后自然地停止赌博,求输光的概率$q(a)$。

解：

[公式] ：第一局赢 [公式] ：有本金 [公式] 时最后输光

则 [公式]

利用全概率公式，有 [公式]

[公式]

故 [公式]

对上式进行累加，得到 [公式]

取 [公式] 可求得 [公式]

故 [公式]

我们发现有趣的是 [公式] 。这说明，就算赌博在规则上完全公平，越贪心则越有可能会输光。在规则上公平的赌博中如果本金有限，一直赌下去，则必定输光。这是一个违反直觉却又无法辩驳的结论。





下面引入Bayes公式

定理（Bayes公式）：

事件 [公式]互斥， [公式] ，若 [公式] ， [公式]

证明：

利用全概公式，逆用条件概率乘法公式即可。

[公式]



同样地，Bayes公式推导也很简单，但是却有着丰富的含义。

Bayes公式描述的是一个“学习”与“逆推”的过程， [公式] 可以看作是诱发了事件 [公式] 的原因， [公式] 就代表了每个原因可能发生的概率，是我们先天便已经具备的知识，称为先验概率。而当发生了事件 [公式] 后，我们对引发其的原因会产生新的认识，便就是 [公式] ，称为后验概率。我们拿着先天的经验或知识来进行实践，得到结果后又反过来用来更新那些我们本来具有的经验知识，重复这一过程我们就可以越来越靠近真理，这便是Bayes公式表现出的“学习性”的含义。



鉴于Bayes公式的重要性，我们给出例子体会其实际应用。

例：调查发现肺癌病人中吸烟人群占 [公式] %，无肺癌人群中有 [公式] %吸烟。若在所有人群中，肺癌的发病率都为 [公式] ，求吸烟人群发病率是不吸烟人群的多少倍？

解：

在做类似问题时应该先合理定义事件。

此处定义 [公式] ：有肺癌 [公式] ：吸烟

由Bayes公式， [公式]

[公式]

同理地， [公式]

故吸烟人群发病率是不吸烟人群的 [公式] 倍。



我们可能认为吸烟率所差无几，所以结果不应该有那么大的患病率差别。但是我们同时也应该注意到肺癌的自然发病率极其小，在这种情况下，吸烟率的差别被放大了。能够得到很多凭借直觉所得不到的结论也是学习概率论的乐趣之一。


### 1.9 事件列的上下极限,Borel-Cantelli引理

本章同样地基本不涉及应用方面，若对理论方面无兴趣可以跳过

我们在先前定义了单调集合列的极限（回忆在概率连续性处提到的内容）

现在我们来引入集合列的上、下极限的定义：

定义：

对事件列 [公式]

设 [公式] ，容易知道 [公式] 单调递减， [公式] 单调递增，则极限存在。

则 [公式] 为 [公式] 的上极限，记为 [公式] ， [公式] 为 [公式] 的下极限，记为 [公式] 。



从定义之中，我们不难推出的是下极限是上极限的子集，即 [公式] 。

进一步地理解，可以发现[公式]发生当且仅当有无穷个 [公式] 发生；而[公式]发生当且仅当最多有限个[公式] 不发生。

由概率的连续性（根本上来说就是概率测度与极限可交换），我们容易得到以下结论：

[公式]

[公式]



特别地，由于[公式]发生当且仅当有无穷个 [公式] 发生，上极限符号常常被记作 [公式] ，即 [公式] （ [公式] 表示 [公式] ）



定理（Borel-Cantelli）：

对事件列[公式]

（1）：若 [公式] ， [公式]

（2）：若事件列中事件相互独立， [公式] ，则 [公式]

证明：

（1）：由[公式]，且 [公式]

得到 [公式] 。

由级数收敛的Cauchy准则， [公式]

故得到 [公式] 。

（2）：想方设法利用独立的条件，则需要事件之交的形式。

[公式] ，故可以先估计 [公式] 。

想到可以利用De-Morgan定律将并换为交，从而利用独立的条件。

[公式]

[公式]

当 [公式] 时，有 [公式] 。通过指数函数将连乘再转化回连加。

[公式]

由 [公式] 发散， [公式]

故可以得到 [公式]

则 [公式] 。



Borel-Cantelli是一个很抽象的定理。在这里，值得一提的是事件列中事件相互独立时， [公式] 的取值只能为 [公式] 或 [公式] 。即对相互独立的事件列，其中有无穷个事件发生的概率要么为 [公式] 要么为 [公式] 。这个结论被称为独立 [公式] 律。

我们可以先考虑简单一些的情况，对独立重复试验（每次发生的概率为常数 [公式] ，无限重复做下去），则 [公式] 当且仅当 [公式] 。这告诉我们在独立重复试验中，当事件每次几乎必然不发生（发生概率为0）时，无穷次地重复下去几乎必然不会有无穷次事件发生。相对地，在独立重复试验中，当事件每次发生的概率不为0（即使再小再趋向于0）时，无穷次地重复下去几乎必然会有无穷次事件发生。

接下来考虑独立的试验（第 [公式] 次发生的概率为会随 [公式] 变化的[公式] ，无限次地做下去）。这里不妨假设 [公式] ，则此定理告诉我们事件列中是否有无穷多个事件发生，只与 [公式] 充分大时 [公式] 的值有关。（这点是符合直觉的）然而，如果 [公式] ，事件列中会有无穷多个事件发生。而 [公式] 时，则不会有无穷多个事件发生。（这又是直觉所感受不到的）

Borel-Cantelli引理不仅仅为我们提供了有趣的结论，还是我们后文得到强大数律的理论基础，在理论工作上是很重要的。



